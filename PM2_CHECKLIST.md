# PM2 Deploy Checklist ‚úÖ

–ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ PM2.

---

## üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

- [ ] PM2 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ
  ```bash
  npm install -g pm2
  ```

- [ ] –°–æ–∑–¥–∞–Ω—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
  ```bash
  mkdir -p backend/logs frontend/logs
  ```

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã `.env` —Ñ–∞–π–ª—ã
  - [ ] `backend/.env` (DATABASE_URL, JWT secrets, SESSION_SECRET)
  - [ ] `frontend/.env` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ecosystem.config.js)

- [ ] MySQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—É—â–µ–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞

---

## üî® –°–±–æ—Ä–∫–∞

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
  ```bash
  cd backend && npm install
  cd ../frontend && npm install
  ```

- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  ```bash
  cd backend
  npm run prisma:generate
  npm run prisma:migrate
  ```

- [ ] –°–æ–±—Ä–∞–Ω Backend
  ```bash
  cd backend
  npm run build:prod
  ```
  –ü—Ä–æ–≤–µ—Ä–∫–∞: `backend/dist/main.js` –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

- [ ] –°–æ–±—Ä–∞–Ω Frontend
  ```bash
  cd frontend
  npm run build:prod
  ```
  –ü—Ä–æ–≤–µ—Ä–∫–∞: `frontend/.output/server/index.mjs` –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

---

## üöÄ –ó–∞–ø—É—Å–∫

- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  ```bash
  pm2 ecosystem ecosystem.config.js
  ```

- [ ] –ó–∞–ø—É—Å–∫ –≤ production —Ä–µ–∂–∏–º–µ
  ```bash
  pm2 start ecosystem.config.js --env production
  ```

- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
  ```bash
  pm2 status
  ```
  –û–±–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å "online"

- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
  ```bash
  pm2 logs --lines 50
  ```
  –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] Backend –æ—Ç–≤–µ—á–∞–µ—Ç
  ```bash
  curl http://localhost:3000/api/health
  # –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π endpoint
  ```

- [ ] Frontend –æ—Ç–≤–µ—á–∞–µ—Ç
  ```bash
  curl http://localhost:3001
  ```

- [ ] WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç
  - –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
  - –°–æ–∑–¥–∞–π—Ç–µ –∏–≥—Ä—É
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DevTools ‚Üí Network ‚Üí WS

- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
  ```bash
  pm2 show pokerscrum-backend
  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ FRONTEND_URL
  ```

---

## ü§ñ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
  ```bash
  pm2 startup
  # –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä—É—é –≤–µ—Ä–Ω–µ—Ç PM2
  ```

- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PM2
  ```bash
  pm2 save
  ```

---

## üîß Nginx (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω reverse proxy –¥–ª—è Backend
  - `localhost:3000` ‚Üí `https://pokerscrum.ru/api`

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω reverse proxy –¥–ª—è Frontend
  - `localhost:3001` ‚Üí `https://pokerscrum.ru/`

- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (Let's Encrypt, etc.)

- [ ] Nginx –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
  ```bash
  sudo nginx -t
  sudo systemctl reload nginx
  ```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU –∏ –ø–∞–º—è—Ç–∏
  ```bash
  pm2 monit
  ```

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–ª–µ—Ä—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ```bash
  pm2 link <secret> <public>  # PM2 Plus
  ```

---

## üéâ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ production URL

- [ ] –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É

- [ ] WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

- [ ] –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö PM2
  ```bash
  pm2 logs --err --lines 100
  ```

- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (DevTools ‚Üí Console)

---

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
pm2 status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs
pm2 logs pokerscrum-backend
pm2 logs pokerscrum-frontend

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart all
pm2 restart pokerscrum-backend
pm2 restart pokerscrum-frontend

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞
pm2 reload all

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 stop all

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
pm2 monit

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
pm2 show pokerscrum-backend

# –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
pm2 flush
```

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs --err

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
ls backend/dist/main.js
ls frontend/.output/server/index.mjs
```

### CORS –æ—à–∏–±–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ FRONTEND_URL
pm2 show pokerscrum-backend

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
pm2 delete pokerscrum-backend
pm2 start ecosystem.config.js --only pokerscrum-backend --env production
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env
cat backend/.env

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL
mysql -u user -p planning_poker
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏
pm2 monit

# –£–º–µ–Ω—å—à–∏—Ç–µ max_memory_restart –≤ ecosystem.config.js
# –ò–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [PM2_DEPLOYMENT.md](PM2_DEPLOYMENT.md) - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ PM2
- [CONFIGURATION_GUIDE.md](CONFIGURATION_GUIDE.md) - –≥–∏–¥ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [Backend README](backend/README.md)
- [Frontend README](frontend/README.md)

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ï—Å–ª–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –æ—Ç–º–µ—á–µ–Ω—ã, –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ —á–µ—Ä–µ–∑ PM2! üéâ

–ù–µ –∑–∞–±—É–¥—å—Ç–µ:
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏: `pm2 logs`
- –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Ä–µ–ª–∏–∑–∞—Ö
- –î–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
